var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};define(["underscore","backbone","collections/translator/translationList","models/translator/translation","common/socket"],function(e,t,n,r,i){var s;return s=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.el="#translator",n.prototype.template="#translation_list_li",n.prototype.events={"click .translate_btn":"openTranslationModal","click #translation_modal .save_btn":"clickModelSaveBtn","click #translation_modal .close_btn":"clickModelCloseBtn","keydown #translation_modal textarea":"updateTranslateStatus"},n.prototype.initialize=function(){return i.on("send:message",e.bind(this.receiveMessage,this)),this.modal=this.$el.find("#translation_modal")},n.prototype.receiveMessage=function(e){var t;console.log("translatorView.receiveMessage"),console.log("=================");if(e.placer!==App.model.user.get("userName"))return t=this.collection.where({requestId:e.requestId}),t.length>0?t[0].set(e):this.collection.add(new r(e)),this.render()},n.prototype.render=function(){var t;return t=this.$el.find(this.template).text(),this.$el.find("#translation_list_section").empty().append(e.template(t,{translations:this.collection.toJSON()}))},n.prototype.openTranslationModal=function(t){var n;n=$(t.target).parents(".translation_tr"),this.modalTargetModel=this.collection.where({requestId:n.data("id")})[0];if(this.modalTargetModel!=null)return this.modal.find("textarea").val(this.modalTargetModel.get("translation")),this.modal.modal().find(".original_text").text(this.modalTargetModel.get("originalText")),this.modalTargetModel.set({translator:App.model.user.get("userName"),status:"acceptance"}),i.emit("send:message",this.modalTargetModel.attributes),setTimeout(e.bind(function(){return this.modal.find("textarea").focus()},this),1e3)},n.prototype.clickModelSaveBtn=function(){var e;return console.log("placerView.clickModelSaveBtn"),e=this.modal.find("textarea").val(),this.modalTargetModel.set({translationText:e,status:"translated",translator:App.model.user.get("userName")}),this.render(),this.modal.modal("hide"),i.emit("send:message",this.modalTargetModel.attributes)},n.prototype.clickModelCloseBtn=function(){return console.log("placerView.clickModelCloseBtn"),this.modalTargetModel.set({translationText:"",status:"wait",translator:""}),this.render(),i.emit("send:message",this.modalTargetModel.attributes)},n.prototype.updateTranslateStatus=function(){var e;return e=this.modal.find("textarea").val(),this.statusCount=this.statusCount!=null||this.statusCount===1?0:1,this.modalTargetModel.set({translationText:e,status:this.statusCount===0?"editing..":"editing...",translator:App.model.user.get("userName")}),i.emit("send:message",this.modalTargetModel.attributes)},n.prototype.show=function(){return this.$el.hide().removeClass("hide").fadeIn("normal")},n.prototype.hide=function(){return this.$el.hide()},n}(t.View)})